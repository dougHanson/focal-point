<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" type="text/css" href="styles.css" /> 
  <style>
    body { 
      background-image: linear-gradient(-225deg, #FFE29F 0%, #FFA99F 48%, #FF719A 100%);
      background: #dadada;
    }
    .output { border: 4px solid #fff; }
  </style>  
</head>


<body>

  <!-- various output image sizes - output class should be hidden with no-js -->
  <div class="output-wrapper">

    <!-- skyscraper -->
    <div class="output skyscraper">
      <img src="tree.jpg" class="js-output" />
    </div> 
    
    <!-- hero -->
    <div class="output hero">
      <img src="couple@3x.jpg" srcset="couple.jpg 400w, couple@2x.jpg 800w, couple@3x.jpg 1600w" class="js-output" />
    </div>    

    <!-- leaderboard -->
    <div class="output leaderboard">
      <img src="image@3x.jpg" srcset="image.jpg 500w, image@2x.jpg 1000w, image@3x.jpg 2000w" class="js-output" />
    </div>

    <!-- leaderboard short -->
    <div class="output leaderboard-short">
      <img src="hand.jpg" class="js-output" style="width: 100%; " />
    </div>

    <!-- feature -->
    <div class="output feature">
      <img src="image@3x.jpg" srcset="image.jpg 500w, image@2x.jpg 1000w, image@3x.jpg 2000w" class="js-output" />
    </div>
    
    <!-- big rec -->
    <div class="output big-rec">
      <img class="js-output" 
           src="image@3x.jpg" 
           srcset="image.jpg 500w, 
                   image@2x.jpg 1000w, 
                   image@3x.jpg 2000w" />
    </div>

    <!-- m rec -->
    <div class="output mrec">
      <img src="couple@3x.jpg" srcset="couple.jpg 400w, couple@2x.jpg 800w, couple@3x.jpg 1600w" class="js-output" />
    </div>    

    
    <!-- thumbnail -->
    <div class="output thumbnail">
      <img src="couple@2x.jpg" srcset="couple.jpg 400w, couple@2x.jpg 800w, couple@3x.jpg 1600w" class="js-output" />
    </div>

    <!-- tiny -->
    <div class="output tiny">
      <img src="image@3x.jpg" srcset="image.jpg 500w, image@2x.jpg 1000w, image@3x.jpg 2000w" class="js-output" style="min-height: 50px; max-height: 100px;" />
    </div> 


    <!-- simple no-js fallback -->
    <noscript>
      <h2>noscript fallback:</h2>
      <div class="output" style="width: 960px; height: 450px;">
        <img src="image.jpg" class="js-output" style="height: auto; max-width: 100%;" />
      </div>
    </noscript>

  </div>


  <script src="https://code.jquery.com/jquery-1.12.4.min.js" crossorigin="anonymous"></script>
  <script>
    var squareClicked = [];
    var gridSize;
    var imgId;

    // CALCMARGINS()
    function calcMargins(focal) {
      $('.js-output').each(function() {       
        imgId = $(this).attr('src');
        if (focal[imgId] !== undefined) {
          squareClicked[0] = focal[imgId].X;
          squareClicked[1] = focal[imgId].Y;
          gridSize = focal[imgId].grid;
        }
        //default to centre if focal point not set
        else {
          squareClicked[0] = 1;   //  _____________ 
          squareClicked[1] = 1;   //  |_0_|___|___|
          gridSize = 3;           //  |___|_X_|___|
        }                         //  |___|___|_2_|
        
        var outputContainerWidth = $(this).parent().width();
        var outputContainerHeight = $(this).parent().height();
        var playX = $(this).width() - outputContainerWidth;
        var playY = $(this).height() - outputContainerHeight;
        var positionX = (((squareClicked[0]) * (1 / (gridSize - 1))) * playX);
        var positionY = (((squareClicked[1]) * (1 / (gridSize - 1))) * playY);

        if (positionX > playX) { positionX = playX; }
        if (positionY > playY) { positionY = playY; }

        $(this).css({ 'margin-left': -positionX, 'margin-top': -positionY });
      });
    }


    $(window).on("load resize", function(e) {
      var obj = JSON.parse(localStorage.getItem('imgMargins'));
      setTimeout(function() { //set small delay to ensure images have resized before recalc of margins
        calcMargins(obj);
      }, 200);

      console.log(obj);
    });
  </script>


</body>

</html>